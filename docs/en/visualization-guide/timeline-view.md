# Timelie View

This document is a part of [User Guide](/docs/en/visualization-guide/user-guide.md).

Timeline view visualizes resource status change timings with timeline charts.

## Category

Resources in the timeline view are displayed in a hierarchical order. [Subresource](#subresource-timeline) are not actual Kubernetes subresources, but KHI associates these complementary timelines with resources for better visualization.

1. Kind
2. Namespace
3. Resouce
4. [Subresource](#subresource-timeline)

![Timeline view timeline diagram](/docs/en/images/guide-timeline-diagram.png)

## Revisions

The colorful belts on the timelines are called `revisions`. Each revision represents a state that continues from its left edge (start time) to its right edge (end time).

Resource timelines use rectangles to visualize when a resource was created, updated, or removed.

![Timeline view timeline revisions](/docs/en/images/guide-timelines-revisions.png)

### Scale the Revisions

To scale the timeline view in or out, hold the Shift key and scroll your mouse. KHI will scale the view around the time point at your mouse pointer location.

### Understanding Revisions Color

- Blue: created,updated or patched
- Red:deleted
- Yellow: KHI infers its existence from other logs but can't retrieve its content
  - A yellow timeline for a resource generally indicates that KHI (your system) has inferred the resource's existence from indirect evidence, but couldn't get its complete content or full lifecycle events. Here are some specific scenarios that yellow color shows up:
    - Container logs were observed inside of the Pod during the query period, but no Pod related logs are found.
    - Pod deletion log was found, but creation log was not inside of the log period. KHI infer the creation time from reading `creationTimestamp` inside of the deletion request.

## Events

Diamond shapes on the timelines are called events in KHI (note: these are not Kubernetes events). They indicate that a log was associated with the resource at that specific time. The colors of these events reflect their severity and log type.

![Timeline view timeline events](/docs/en/images/guide-timelines-events.png)

### Log Type

Colors assigned to queries are documented on [KHI logs](TBA).

### Severity

KHI normalizes log severities into 5 levels, regardless of how they're categorized in Cloud Logging. This means KHI's severity might not always match the severity recognized by Cloud Logging.

For instance, a log might be classified as DEFAULT level in Cloud Logging, but KHI will treat it as an ERROR level if its message content indicates an error.

#### Understanding Severity Color

- Blue: INFO level
- Yellow: WARN level
- Red: ERROR level
- Purple: FATAL level
- Black: Unknown level

## Subresource Timeline

KHI shows several supplemental timelines as subresource timelines. There are 9 subresources. While these are not actual Kubernetes subresources, KHI associates these complementary timelines with resources for better visualization. The color meanings of these subresources may vary, indicated by a colorful chip next to the subresource name on the left side, reflecting their relationship with their parent resource.

### `status`

Some resouces have a `status` field (e.g., Node, Pod, Deployment, etc.). Controllers for these resources update the `status` field to reflect the observed status from the controller's perspective.

#### Understanding `status` Timeline Color

![status timeline color](/docs/images/subresource-status.png)

- Green: condition status is `True`
  - Green often appears to signify a healthy status, but it actually just means the condition is `True`. For example, a `Ready` status on a Node is interpreted as healthy when it's True. However, a `FrequentDockerRestart` status on a Node is interpreted as unhealthy when it's True.
- Orange: condition status is `False`
- Purple: condition status is `Unknown` or the actual status can't be determined from the log

  - An `Unknown` status does not always mean a bad state. Here are some specific scenarios that yellow color shows up:
    - There is a network issues on the node, preventing Kubelet from reporting a healthy status to kube-apiserver.
    - The last status change fell outside the query range. This is because some status change requests are patch requests, which only update the last transition time of the state without containing the full state value.

### `operation`

GCP audit logs sometimes include an `operation` field. KHI parses these logs and automatically groups them by operation ID. They are displayed under the related resource.

`operation` subresource is generated by following parsers. If the corresponding log parser features aren't enabled for a query, KHI won't show it on the timeline.

- GKE Audit Log
- GCE networking log
- Compute API log
- Anthos　OnPrem log
- Anthos Multicloud log

#### Understanding `operation` Timeline Color

![status timeline color](/docs/images/subresource-operation.png)
KHI shows these operation range from log. If operation start log is not included in the query range, then KHI can only show the gray timeline.

- Green: operation is running
- Gray: operation is finished

### `node-component`

Node components are system workloads that run on Kubernetes worker nodes but aren't managed by Pods. This mainly includes `kubelet` and `containerd`. Scripts needed for configuring a worker node, such as `configure.sh` or `configure-helper.sh`, are also recorded in the node component logs.

#### Understanding `node-component` Timeline Color

![status timeline color](/docs/images/subresource-node-component.png)

- Blue: The first log is observed
- Red: A termination log is observed
- Yellow: KHI does not support parsing the lifetime of the node component

### `container`

Container statuses are recorded in the `.status.containerStatuses` field within Pods. KHI parses this field to visualize when these pods become started, ready, or terminated.

Pod status updates are not always logged if [Data Write Audit log](https://cloud.google.com/logging/docs/audit/configure-data-access#configuration_overview) on the Kubernetes Engine API hasn't enabled. Consequently, most `container` timelines remain unknown when the audit log is not turned on.

#### Understanding `container` Timeline Color

![status timeline color](/docs/images/subresource-container.png)

- Yellow: the container is waiting to be started or status can't be identified from logs
- Orange: the container is running but its status is not ready
- Light Green: the container is running and its status is ready
- Dark Green: after container exit with exit code 0
- Dark Red: after container exit with non zero exit code

### `endpointslice`

The EndpointSlice resource in Kubernetes is used for managing the readiness of endpoints associated with a Service. Kubernetes automatically creates it when a user creates a Service, and its status indicates which Pods are ready or not.

#### Understanding `endpointslice` Timeline Color

![status timeline color](/docs/images/subresource-endpointslice.png)

- Green:  the Pod is routable from the associated service
- Orange: the Pod is not routable from associated service

### `neg`

Network endpoint group is commonly used to associate Pods and load balancers. KHI parses GCE network logs and show when the associated NEG become ready or not on Pod timeline.

#### Understanding `neg` Timeline Color

![status timeline color](/docs/images/subresource-neg.png)

- Green:  the Pod is attached to the NEG
- Orange: the Pod is detached from the NEG

### `binds`

When a Pod is created, `kube-scheduler` is responsible for determining which node will run it. After deciding on the node, `kube-scheduler` creates a `binding` subresource associated with the Pod. While this is easily viewable from the Pod's perspective, it's difficult to ascertain which Pods are running from the Node's perspective. To address this, KHI places the binding timeline under the Node resource.

KHI timeline only reflects the decision from `kube-scheduler`. To confirm if the Pod actually succeeded in running on the node, we need to check the actual Pod timeline.

#### Understanding `binds` Timeline Color

![status timeline color](/docs/images/subresource-binds.png)

- Blue: after the Pod is scheduled on the node
- Red: after the Pod is removed from the node

### `owns`

Kubernetes resources create other resources through their controllers. For example, a Deployment resource creates a ReplicaSet resource, and a ReplicaSet resource in turn creates a Pod. The [`metadata.ownerReference` field](https://kubernetes.io/docs/concepts/overview/working-with-objects/owners-dependents/) in a Kubernetes manifest records the parent of the resource.

#### Understanding `owns` Timeline Color

![status timeline color](/docs/images/subresource-owns.png)

The `owns` timeline differs from other pseudo-timelines because it's simply an alias of the actual timeline, referencing its child.

### `mig`

A Managed Instance Group (MIG) is used for GCE instances created by a nodepool. A MIG's name is sometimes referenced in autoscaler logs or nodepool-related logs. This timeline is placed under the associated nodepool.

#### Understanding `mig` Timeline Color

![status timeline color](/docs/images/subresource-mig.png)

Currently, the MIG timeline does not contain any revision logs, but it can contain only event logs. There are no timelines specifically needed for MIGs; refer to [Supported Log Types](TBA) or the colors of points on MIG timelines.

## Opening Log View and History View from Timeline View

Clicking on any element on the timeline view. The log view and history view on the right side of the timeline view will then display data corresponding to the selected timeline.

![Timeline view timeline selection](/docs/en/images/guide-timeline-selection.png)

Read [LogView](TBA) and [History View](TBA) for more details.

## Keyboard Shortcuts

To scale the timeline view in or out, hold the Shift key and scroll your mouse. KHI will scale the view around the time point at your mouse pointer location.

| Keyboard Shortcut | Action |
|---|---|
| Mouse scroll | Scroll down/up the timeline list |
| Shift + Mouse scroll | Scale up/down timeline |
| ↓ | Select next timeline |
| ↑ | Select previous timeline |
| Shift + ↓ | Select next resource timeline |
| Shift + ↑ | Select previous resource timeline |
| Alt + ↓ | Select next namespace timeline |
| Alt + ↑ | Select previous namespace timeline |
| Shift + Alt + ↓ | Select next kind timeline |
| Shift + Alt + ↑ | Select previous kind timeline |
| ← | Select previous resource revision or event |
| → | Select next resource revision or event |
| Shift + ← | Select the first resource revision or event |
| Shift + ← | Select the last resource revision or event |
